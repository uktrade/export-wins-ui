var ew={components:{},pages:{},tools:{},controllers:{},application:{components:{},controllers:{}}};ew.CustomEvent=function(){function a(){this.subscribers=[]}var b=a.prototype;return b.subscribe=function(a){this.subscribers.push(a)},b.unSubscribe=function(a){for(var b=0,c=this.subscribers.length;b<c;b++)if(this.subscribers[b]===a){this.subscribers.pop(b,1);break}},b.publish=function(){for(var a=this.subscribers.length-1;a>=0;a--)try{this.subscribers[a].apply(this,arguments)}catch(a){}},a}(),ew.tools.toLocaleString=function(a,b,c){b=b||",",c=0===c?c:3;for(var d,e=(""+a).split("."),f=e[0].length,g="";f>c;)d=f-c,g=b+e[0].slice(d,f)+g,f=d;return g=e[0].slice(0,f)+g,e[0]=g,e.join(".")},ew.components.AddContributors=function(a){function b(a){return a+" is required for AddContributorsComponent"}function c(c){if(!c)throw new Error(b("opts"));if(!c.contributorsSelector)throw new Error(b("opts.contributorsSelector"));if(!c.nameInputSelector)throw new Error(b("opts.nameInputSelector"));var d=this;this.$contributors=a(c.contributorsSelector),this.contributorsSelector=c.contributorsSelector,this.nameInputSelector=c.nameInputSelector,this.shownContributors=0,this.contributorsLength=this.$contributors.length,this.$removeButton=a('<button type="button" class="btn btn-xs btn-default remove-contributor" aria-label="Remove contributor" title="Remove contributor">Remove</button>'),this.createAddButton(),this.hideContributingLines(),this.showCloseButton(),this.$addButton.on("click",a.proxy(this.addContributor,this)),this.$contributors.on("click",".remove-contributor",function(a){d.removeContributor(a,this)})}return c.prototype.focusOnFirstNameInput=function(){var b=a(this.$contributors[0]).find(this.nameInputSelector);b.val()||b.focus()},c.prototype.showCloseButton=function(){var b=a(this.contributorsSelector+":visible").last();b.is(this.$contributors[0])||b.prepend(this.$removeButton)},c.prototype.removeCloseButton=function(){this.$removeButton.remove()},c.prototype.updateCloseButton=function(){var a=this;this.removeCloseButton(),window.setTimeout(function(){a.showCloseButton()},1)},c.prototype.createAddButton=function(){this.$addButton=a('<button class="btn btn-default">Add another contributor</button>'),this.$contributors.parent().append(this.$addButton)},c.prototype.hideContributingLines=function(){var b=this;b.$contributors.each(function(c){var d,e=a(this);0===c?e.show():c>b.shownContributors?(d=e.find(b.nameInputSelector),d.val().length>0?(e.show(),b.shownContributors++):e.hide()):e.hide()})},c.prototype.addContributor=function(b){var c;b.preventDefault(),this.shownContributors<this.contributorsLength?(this.shownContributors++,c=a(this.$contributors[this.shownContributors]),c.show(),c.find(this.nameInputSelector).focus(),this.updateCloseButton(),this.checkAddButtonState()):alert("Sorry, the system can't add more than 5 contributing teams. Please choose teams that contributed the most.")},c.prototype.checkAddButtonState=function(){var a=this.shownContributors===this.contributorsLength-1;this.$addButton[0].disabled=a},c.prototype.resetAll=function(){var b=this;this.$contributors.each(function(){b.resetContributor(a(this))})},c.prototype.resetContributor=function(a){a.find("input").val(""),a.find("select").each(function(){this.selectedIndex=0}),a.find(".alert-danger").remove(),a.removeClass("error")},c.prototype.removeContributor=function(b,c){var d=a(c).parent(this.contributorsSelector);d.hide(),this.resetContributor(d),this.shownContributors--,this.updateCloseButton(),this.checkAddButtonState()},c}(jQuery),ew.components.AddSelect=function(a){function b(a){return a+" is required for AddSelectComponent"}function c(c){if(!c)throw new Error(b("opts"));if(!c.selector)throw new Error(b("opts.selector"));if(!c.labelText)throw new Error(b("opts.labelText"));this.selector=c.selector,this.required=!!c.required,this.labelText=c.labelText,this.buttonText=c.buttonText||"Add another",this.minVisible=0===c.minVisible?0:c.minVisible||1,this.$selects=a(this.selector),this.$groups=this.$selects.closest(".form-group"),this.$group=this.$selects.closest(".add-select-group"),this.count=this.$selects.length,this.visible=this.count,this.$addButton=a('<button class="btn btn-default">'+this.buttonText+"</button>"),this.$removeButton=a('<button class="btn btn-default remove-select">Remove</button>'),this.ensureSeqential(),this.hideOthers(),this.createLabel(),this.$addButton.appendTo(this.$group),this.updateRemoveButton(),this.checkAddButtonState(),this.$addButton.on("click",a.proxy(this.addSelect,this)),this.$groups.on("click",".remove-select",a.proxy(this.removeSelect,this))}var d="disabled";return c.prototype.createLabel=function(){this.$groups.find("label, span").remove();var b=a('<h4 class="form-label">'+this.labelText+"</h4>");this.required&&b.prepend('<span class="required">*</span>'),this.$group.prepend(b)},c.prototype.removeSelect=function(b){b.preventDefault(),this.visible--,a(this.$groups[this.visible]).hide(),this.$selects[this.visible].selectedIndex=0,this.visible<this.count&&this.$addButton.removeClass(d),this.updateRemoveButton()},c.prototype.ensureSeqential=function(){var a=this.count-1,b=this.$selects;b.each(function(c){if(c<a){var d,e=c+1;for(d=b[e];e<=a&&d&&0===d.selectedIndex;)d=b[e],e++;0===this.selectedIndex&&d.selectedIndex>0&&(this.selectedIndex=d.selectedIndex,d.selectedIndex=0)}})},c.prototype.hideOthers=function(){for(var b=this.minVisible;b<this.count;b++)0===this.$selects[b].selectedIndex&&(a(this.$groups[b]).hide(),this.visible--)},c.prototype.checkAddButtonState=function(){this.visible===this.count&&this.$addButton.addClass(d)},c.prototype.updateRemoveButton=function(){this.visible>this.minVisible?this.$removeButton.insertAfter(this.$selects[this.visible-1]):this.$removeButton.remove()},c.prototype.addSelect=function(b){b.preventDefault(),this.visible<this.count&&(a(this.$groups[this.visible]).show(),this.visible++,this.updateRemoveButton(),this.checkAddButtonState())},c}(jQuery),ew.components.CalculateExportValue=function(a,b,c){function d(a){return a+" is required for CalculateExportValueComponent"}function e(a){if(!a)throw new Error(d("opts"));if(!a.values)throw new Error(d("opts.values"));if(!a.total)throw new Error(d("opts.total"));this.values=a.values,this.$total=b("#"+a.total),this.currency="Â£",this.$values=[],this.updateHtml(),this.getValueElems(),this.setupListeners(),this.updateValue()}var f=/^0+$/;return e.prototype.resetValues=function(){for(var a,b=0;a=this.$values[b++];)a.val(0);this.updateValue()},e.prototype.updateHtml=function(){var b="export-total-years",c="export-total-value",d=this.$total.parents(".form-group"),e=a.createElement("p");this.$total.hide(),d.find(".help-text").hide(),d.find("label").hide(),d.find(".required").hide(),e.className="export-total",e.innerHTML='Totaling over <span class="'+b+'"></span>: <span class="'+c+'"</span>',d[0].appendChild(e),this.$totalYears=d.find("."+b),this.$totalValue=d.find("."+c)},e.prototype.getValueElems=function(){for(var a,c=0;a=this.values[c++];)a="#"+a,this.$values.push(b(a))},e.prototype.setupListeners=function(){function a(a){c.on("keyup",f),a.on("focus",function(){d.handleFocus(a)}),a.on("blur",function(){d.handleBlur(a)})}for(var c,d=this,e=0,f=b.proxy(this.updateValue,this);c=this.$values[e++];)a(c)},e.prototype.handleBlur=function(a){var b=a.val();(""===b||f.test(b))&&a.val(0)},e.prototype.handleFocus=function(a){f.test(a.val())&&a.val("")},e.prototype.updateValue=function(){for(var a,b,d=0,e=0,f=0;a=this.$values[e++];)b=parseInt(a.val(),10),b>0&&(d+=b,f++);this.$totalYears.text(f+(1===f?" year":" years")),this.$totalValue.text(this.currency+c(d)),this.$total.val(d)},e}(document,jQuery,ew.tools.toLocaleString),ew.components.CleanPastedInput=function(){function a(a){this.$elem=a,this.elem=a[0],this.$elem.on("paste",$.proxy(this.handlePaste,this))}return a.prototype.cleanValue=function(){this.elem.value=this.elem.value.replace(/^\s+|\s+$/g,"")},a.prototype.handlePaste=function(){this.elem&&setTimeout($.proxy(this.cleanValue,this),1)},a}(),ew.components.DisableMultiSubmit=function(a){function b(b,c){if(!b)throw new Error("formId is required for DisableMultiSubmitComponent");this.$form=a("#"+b),this.savingText=c||"Saving...",this.$submitButton=this.$form.find("input[type=submit]"),this.submitInProgress=!1,this.$form.on("submit",a.proxy(this.handleSubmit,this))}return b.prototype.handleSubmit=function(a){this.submitInProgress?a.preventDefault():(this.submitInProgress=!0,this.$submitButton.attr("disabled",!0),this.$submitButton.val(this.savingText))},b}(jQuery),ew.components.ToggleContributors=function(a,b){function c(a){return a+" is required for ToggleContributorsComponent"}function d(a){if(!a)throw new Error(c("opts"));if(!a.$contributingTeamDetails)throw new Error(c("opts.$contributingTeamDetails"));if(!a.$someContributors)throw new Error(c("opts.$someContributors"));if(!a.noContributorsSelector)throw new Error(c("opts.noContributorsSelector"));this.$contributingTeamDetails=a.$contributingTeamDetails,this.$someContributors=a.$someContributors,this.noContributorsSelector=a.noContributorsSelector,this.events={showDetails:new b,hideDetails:new b},this.checkContributingDetails(),this.createListeners()}return d.prototype.toggleContributingDetails=function(a){this.$someContributors[0].checked?(this.$contributingTeamDetails.show(),this.events.showDetails.publish()):(this.$contributingTeamDetails.hide(),this.events.hideDetails.publish())},d.prototype.createListeners=function(){var b=a(this.noContributorsSelector),c=a.proxy(this.toggleContributingDetails,this);this.$someContributors.on("click",c),b.on("click",c)},d.prototype.checkContributingDetails=function(){this.$someContributors[0].checked||this.$contributingTeamDetails.hide()},d}(jQuery,ew.CustomEvent),ew.components.ToggleExportValue=function(a,b){function c(a){return a+" is required for ToggleExportValueComponent"}function d(d){if(!d)throw new Error(c("opts"));if(!d.fieldId)throw new Error(c("opts.fieldId"));if(!d.contentId)throw new Error(c("opts.contentId"));this.events={hide:new b},this.$content=a("#"+d.contentId),this.$field=a("#"+d.fieldId),this.$field.on("change",a.proxy(this.showContent,this)),this.showContent()}return d.prototype.showContent=function(){this.$field[0].checked?this.$content.show():(this.$content.hide(),this.events.hide.publish())},d}(jQuery,ew.CustomEvent),ew.components.UpdateSelect=function(a){function b(a){return a+" is required for UpdateSelectComponent"}function c(c){if(!c)throw new Error(b("opts"));if(!c.firstSelect)throw new Error(b("opts.firstSelect"));if(!c.secondSelect)throw new Error(b("opts.secondSelect"));var d=this;if(d.delimiter=c.delimiter||":",d.$firstSelect=a(c.firstSelect),d.$secondSelect=a(c.secondSelect),d.$secondSelectOptions=d.$secondSelect.find("option"),!d.$firstSelect.length)throw new Error("firstSelect not found");if(!d.$secondSelect.length)throw new Error("secondSelect not found");if(d.$options=d.$secondSelectOptions.clone(),!d.$options.length)throw new Error("Select contains no options");d.$firstSelect.on("change",function(){d.handleChange(this)}),d.setInitialState()}return c.prototype.setInitialState=function(){var a=this.$firstSelect.val();this.setOptions(a)},c.prototype.setOptions=function(a){a?this.updateOptions(a):this.chooseTeamMessage()},c.prototype.chooseTeamMessage=function(){var a=this.$options.clone(),b=a.filter(function(){return""===this.value});b.text("Please choose a team type first"),this.$secondSelect.empty().append(b)},c.prototype.updateOptions=function(a){var b=this.$options.clone(),c=a+this.delimiter,d=c.length,e=b.filter(function(a){return""===this.value||this.value.substring(0,d)===c});this.$secondSelect.empty(),e.appendTo(this.$secondSelect)},c.prototype.handleChange=function(a){var b=a.value;this.setOptions(b),this.$secondSelect[0].selectedIndex=0},c}(jQuery),ew.components.WordCounter=function(a){function b(a){return a+"is required for WordCounterComponent"}function c(c){if(!c)throw new Error(b("opts"));if(!c.limit)throw new Error(b("opts.limit"));if(!c.id)throw new Error(b("opts.id"));this.limit=c.limit,this.$input=a("#"+c.id),this.createCounter(),this.$input.on("keyup",a.proxy(this.upateCount,this))}var d="text-danger";return c.prototype.createCounter=function(){this.$counter=a('<span class="word-counter">0 words</span>'),this.$counter.insertAfter(this.$input),this.upateCount()},c.prototype.getWordCount=function(a){return a.replace(/\s+$/,"").split(" ").length},c.prototype.upateCount=function(){var a=this.$input.val(),b=a?this.getWordCount(a):0,c=1===b?"word":"words";this.$counter.text(b+" "+c),b>this.limit?this.$counter.addClass(d):this.$counter.removeClass(d)},c}(jQuery),ew.controllers.Contributors=function(){function a(a){return a+" is a required parameter for ContributorsController"}function b(b,c){if(!b)throw new Error(a("toggleContributors"));if(!c)throw new Error(a("addContributors"));b.events.showDetails.subscribe(function(){c.focusOnFirstNameInput(),c.updateCloseButton()}),b.events.hideDetails.subscribe(function(){c.resetAll()})}return b}(),ew.controllers.ExportValue=function(){function a(a){return a+" is required for ExportValueController"}function b(b,c){if(!b.exportValue)throw new Error(a("fields.exportValue"));if(!b.nonExportValue)throw new Error(a("fields.nonExportValue"));if(!b.odiValue)throw new Error(a("fields.odiValue"));this.setupFields(b)}return b.prototype.setupFields=function(a){a.exportValue.toggler.events.hide.subscribe(function(){a.exportValue.calculator.resetValues()}),a.nonExportValue.toggler.events.hide.subscribe(function(){a.nonExportValue.calculator.resetValues()}),a.odiValue.toggler.events.hide.subscribe(function(){a.odiValue.calculator.resetValues()})},b}(),ew.pages.confirmationForm=function(){function a(a){var b=$("#confirm-false-info"),c=$("form input[name="+a+"]");c[1].checked||b.hide(),c.on("change",function(a){c[0].checked?b.hide():b.show()})}function b(a){function b(){var a=c.filter(":checked").val(),b=a===f;b?(d.show(),e.focus()):(d.hide(),e.val(""))}var c=$("form input[name="+a.inputName+"]"),d=$("."+a.otherWrapper),e=$("form input[name="+a.otherInputName+"]"),f=c.last().val();c.change(b),b()}function c(c,d,e){a(d),b(e),ew.application.components.stopConfirmationFormSubmit=new ew.components.DisableMultiSubmit(c)}return c}(),ew.pages.officerForm=function(){function a(){var a=[];return $(".contributing-officer-team-group").each(function(){var b=$(this);a.push(new ew.components.UpdateSelect({firstSelect:b.find(".contributing-team-type select")[0],secondSelect:b.find(".contributing-team select")[0]}))}),a}function b(a,b,c){b.descriptionWordCounter=new ew.components.WordCounter({id:a.descriptionId,limit:50}),b.exportValue=new ew.components.ToggleExportValue({fieldId:a.exportType.exportValue,contentId:a.exportContentId}),b.nonExportValue=new ew.components.ToggleExportValue({fieldId:a.exportType.nonExportValue,contentId:a.nonExportContentId}),b.odiValue=new ew.components.ToggleExportValue({fieldId:a.exportType.odiValue,contentId:a.odiContentId}),b.calculateExportValue=new ew.components.CalculateExportValue({values:a.exportValues,total:a.exportTotal}),b.calculateNonExportValue=new ew.components.CalculateExportValue({values:a.nonExportValues,total:a.nonExportTotal}),b.calculateOdiValue=new ew.components.CalculateExportValue({values:a.odiValues,total:a.odiTotal}),c.exportValue=new ew.controllers.ExportValue({exportValue:{toggler:b.exportValue,calculator:b.calculateExportValue},nonExportValue:{toggler:b.nonExportValue,calculator:b.calculateNonExportValue},odiValue:{toggler:b.odiValue,calculator:b.calculateOdiValue}})}function c(b,c,d){c.leadOfficerTeam=new ew.components.UpdateSelect({firstSelect:"#id_team_type",secondSelect:"#id_hq_team"}),c.contributingOfficerTeams=a(),c.toggleContributors=new ew.components.ToggleContributors({$contributingTeamDetails:$("#contributing-teams-details"),$someContributors:$("#some-contributors"),noContributorsSelector:"#no-contributors"}),c.addContributors=new ew.components.AddContributors({contributorsSelector:".contributing-officer-group",nameInputSelector:".contributing-officer-name input"}),c.stopWinFormSubmit=new ew.components.DisableMultiSubmit(b.formId),d.contributors=new ew.controllers.Contributors(c.toggleContributors,c.addContributors),c.supportSelects=new ew.components.AddSelect(b.supportGroup),c.programmeSelects=new ew.components.AddSelect(b.programmeGroup),c.contactEmailCleaner=new ew.components.CleanPastedInput($("#id_customer_email_address")),c.leadOfficerEmailCleaner=new ew.components.CleanPastedInput($("#id_lead_officer_email_address")),c.secondaryEmailCleaner=new ew.components.CleanPastedInput($("#id_other_official_email_address"))}function d(a){return a+" is required for officerFormPage"}function e(a){var b;a.value!==a.remove&&(b=$("#"+a.id+" option"),b.each(function(b,c){if(c.value===a.remove)return $(c).remove(),!1}))}return function(a){if(!a)throw new Error(d("opts"));if("undefined"==typeof a.isComplete)throw new Error(d("opts.isComplete"));if(!a.formId)throw new Error(d("opts.formId"));if(!a.supportGroup)throw new Error(d("opts.supportGroup"));if(!a.programmeGroup)throw new Error(d("opts.programmeGroup"));if(!a.isComplete){if(!a.descriptionId)throw new Error(d("opts.descriptionId"));if(!a.exportType)throw new Error(d("opts.exportType"));if(!a.exportType.exportValue)throw new Error(d("opts.exportType.exportValue"));if(!a.exportType.nonExportValue)throw new Error(d("opts.exportType.nonExportValue"));if(!a.exportType.odiValue)throw new Error(d("opts.exportType.odiValue"));if(!a.exportContentId)throw new Error(d("opts.exportContentId"));if(!a.nonExportContentId)throw new Error(d("opts.nonExportContentId"));if(!a.exportValues||!a.exportValues.length)throw new Error(d("opts.exportValue"));if(!a.exportTotal)throw new Error(d("opts.exportTotal"));if(!a.nonExportValues||!a.nonExportValues.length)throw new Error(d("opts.nonExportValues"));if(!a.nonExportTotal)throw new Error(d("opts.nonExportTotal"));a.country&&e(a.country)}var f=ew.application,g=f.components,h=f.controllers;c(a,g,h),a.isComplete||b(a,g,h)}}(),ew.pages.winComplete=function(a){ew.application.components.stopWinCompleteForm=new ew.components.DisableMultiSubmit(a,"Sending win...")};
//# sourceMappingURL=main_2018-04-29.min.js.map